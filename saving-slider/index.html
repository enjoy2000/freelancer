<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Saving Slider</title>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/css/uikit.min.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

	<!-- Saving Slider -->
	<div id="saving-slider" class="uk-width-1-1">
	    <div class="uk-align-center uk-container-center">

            <!-- Gauges -->
            <div id="gauges" class="uk-align-center">
                <div class="uk-display-inline-block gauge-left spend-year1">
                    <div class="uk-width-1-1">
                        <img class="gauge" src="img/gauge-left.png" alt="Gauge" />
                        <img class="kim" src="img/needle.png" alt="Neddle" />
                    </div>
                    <div class="calculate uk-text-center">
                        <p class="money gauge-money">$ <span class="price">0</span></p>
                        <p class="text">
                            Current one year spending
                        </p>
                    </div>
                </div>
                <div class="uk-display-inline-block gauge-left spend-total">
                    <div class="uk-width-1-1">
                        <img class="gauge" src="img/gauge-left.png" alt="Gauge" />
                        <img class="kim" src="img/needle.png" alt="Neddle" />
                    </div>
                    <div class="calculate uk-text-center">
                        <p class="money gauge-money">$ <span class="price">0</span></p>
                        <p class="text">
                            Current five years spending
                        </p>
                    </div>
                </div>
                <div class="uk-display-inline-block gauge-right save-year1">
                    <div class="uk-width-1-1">
                        <img class="gauge" src="img/gauge-right.png" alt="Gauge" />
                        <img class="kim" src="img/needle.png" alt="Neddle" />
                    </div>
                    <div class="calculate uk-text-center">
                        <p class="money gauge-money">$ <span class="price">0</span></p>
                        <p class="text">
                            Current one year saving
                        </p>
                    </div>
                </div>
                <div class="uk-display-inline-block gauge-right save-total">
                    <div class="uk-width-1-1">
                        <img class="gauge" src="img/gauge-right.png" alt="Gauge" />
                        <img class="kim" src="img/needle.png" alt="Neddle" />
                    </div>
                    <div class="calculate uk-text-center">
                        <p class="money gauge-money">$ <span class="price">0</span></p>
                        <p class="text">
                            Current five years saving
                        </p>
                    </div>
                </div>
            </div>

            <!-- Slider -->
	        <div id="slider" class="uk-text-center">
	            <p class="uk-display-inline-block">How much your last electric bill?</p>
	            <div class="input-slider uk-display-inline-block">

	            </div>
	            <span class="user-input money uk-display-inline-block">$ <span class="price">0</span></span>
	        </div>
        </div>
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/js/uikit.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

    <script>
        $(document).ready(function(){
            var savingRange = [
                {
                    min: 0,
                    max: 74,
                    percentage: 0
                },
                {
                    min: 75,
                    max: 99,
                    percentage: 4
                },
                {
                    min: 100,
                    max: 149,
                    percentage: 16
                },
                {
                    min: 150,
                    max: 199,
                    percentage: 27
                },
                {
                    min: 200,
                    max: 249,
                    percentage: 33
                },
                {
                    min: 250,
                    max: 299,
                    percentage: 37
                },
                {
                    min: 300,
                    max: 349,
                    percentage: 40
                },
                {
                    min: 350,
                    max: 399,
                    percentage: 43
                },
                {
                    min: 400,
                    max: 449,
                    percentage: 45
                },
                {
                    min: 450,
                    max: 699,
                    percentage: 48
                },
                {
                    min: 700,
                    max: 899,
                    percentage: 51
                },
                {
                    min: 900,
                    max: 1199,
                    percentage: 53
                },
                {
                    min: 1200,
                    max: 2499,
                    percentage: 55
                },
                {
                    min: 2500,
                    max: 5000,
                    percentage: 56
                },
            ];
            var increasePercent = [6.7, 13.4, 20.1, 26.8, 33.5];
            // define max slider range
            maxRange = 2400;

            // center needle in gauge
            var needles = $('img.kim');
            needles.each(function(){
                var width = $(this).width();
                var gaugeWidth = $(this).parent().width();
                $(this).css('left', (gaugeWidth - width)/2);
            });

            var result = {
                spendYear1: 0,  // spending in 1st year
                spendTotal: 0,  // spending in 5 years
                saveYear1: 0,  // saving in 1st year
                saveTotal: 0  // saving in 5 years
            }


            // start calculating when slider change value
            $('.input-slider').slider({
                max: maxRange,
                range: 10,
                start: function(event, ui) {
                    resetNeedle();
                },
                stop: function(event, ui) {

                    /**
                    Based on requirement we just need our gauges always on 60-80%
                    If user input = 0, reset gauges to -90deg
                    */
                    if (ui.value != 0) {
                        var maxResult = getSpendingAndSaving(maxRange);
                        var degSpendYear1 = Math.floor( 180 * result.spendYear1/maxResult.spendYear1 - 90 );
                        var degSpendTotal = Math.floor( 180 * result.spendTotal/maxResult.spendTotal - 90 );
                        var degSaveYear1 = Math.floor( 180 * result.saveYear1/maxResult.saveYear1 - 90 );
                        var degSaveTotal = Math.floor( 180 * result.saveTotal/maxResult.saveTotal - 90 );

                        // always on 60 - 80%
                        degSpendYear1 = degSpendTotal = degSaveYear1 = degSaveTotal = getRandomArbitrary(36, 70);

                        degSpendYear1 = getRandomArbitrary(degSpendYear1-10, degSpendYear1+10);
                        degSpendTotal = getRandomArbitrary(degSpendTotal-10, degSpendTotal+10);
                        egSaveYear1 = getRandomArbitrary(degSaveYear1-10, degSaveYear1+10);
                        degSaveTotal = getRandomArbitrary(degSaveTotal-10, degSaveTotal+10);

                        // reset the needle
                        $.when(resetNeedle()).then(function(){

                            // start to rotate
                            $('.spend-year1 img.kim').rotate(degSpendYear1);
                            $('.spend-total img.kim').rotate(degSpendTotal);
                            $('.save-year1 img.kim').rotate(egSaveYear1);
                            $('.save-total img.kim').rotate(degSaveTotal);

                        });
                    } else {
                        console.log('slider value become 0');
                        resetNeedle();
                    }
                },
                slide: function(event, ui) {
                    result = getSpendingAndSaving(ui.value);

                    // ui-slider-range
                    $('.ui-slider-range').css('width', ui.value*100/2400 + '%');

                    // show money
                    $('.spend-year1 .price').html(result.spendYear1.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                    $('.spend-total .price').html(result.spendTotal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                    $('.save-year1 .price').html(result.saveYear1.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                    $('.save-total .price').html(result.saveTotal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));

                    // user input
                    $('span.user-input span.price').html(ui.value);
                }
            });

            // function reset needle
            function resetNeedle() {
                $('.spend-year1 img.kim').rotate(-90);
                $('.spend-total img.kim').rotate(-90);
                $('.save-year1 img.kim').rotate(-90);
                $('.save-total img.kim').rotate(-90);
            }
            
            // create jquery function css transform rotate
            $.fn.rotate = function(deg) {
                // normal
                this.css('transform', 'rotate(' + deg + 'deg)');
                // webkit
                this.css('-webkit-transform', 'rotate(' + deg + 'deg)');
                // moz
                this.css('-moz-transform', 'rotate(' + deg + 'deg)');
                // ms
                this.css('-ms-transform', 'rotate(' + deg + 'deg)');
            }

            // function get random in range min max
            function getRandomArbitrary(min, max) {
                return Math.random() * (max - min) + min;
            }

            // function get spending and saving in 1st year and total 5 years
            function getSpendingAndSaving($inputValue){
                // get saving range
                var savingPercentage = 0;  // saving percentage
                var spendingAndSaving = {
                    spendYear1: 0,  // spending in 1st year
                    spendTotal: 0,  // spending in 5 years
                    saveYear1: 0,  // saving in 1st year
                    saveTotal: 0  // saving in 5 years
                }

                // loop saving range to find percentage based on uer input
                $.each(savingRange, function(){
                    if(this.min <= $inputValue && $inputValue <= this.max) {
                        savingPercentage = this.percentage;
                    }
                });

                // get spend in 1st year
                spendingAndSaving.spendYear1 = $inputValue*12*(100 + increasePercent[0])/100;
                // round result
                spendingAndSaving.spendYear1 = Math.round(spendingAndSaving.spendYear1);

                // get total spend in 5 years
                $.each(increasePercent, function(){
                    spendingAndSaving.spendTotal += $inputValue*12*(100 + this)/100;
                });
                // round spend total
                spendingAndSaving.spendTotal = Math.round(spendingAndSaving.spendTotal);

                // get saving in 1st year
                spendingAndSaving.saveYear1 = spendingAndSaving.spendYear1*savingPercentage/100;
                spendingAndSaving.saveYear1 = Math.round(spendingAndSaving.saveYear1);
                //get saving in 5 years
                spendingAndSaving.saveTotal = spendingAndSaving.spendTotal*savingPercentage/100;
                spendingAndSaving.saveTotal = Math.round(spendingAndSaving.saveTotal);

                // return object
                return spendingAndSaving;
            }
        });
    </script>
</body>
</html>