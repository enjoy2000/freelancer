<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Saving Slider</title>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
    <div id="saving-slider">
        <div id="slider">
            <p>How much your last electric bill?</p>
            <div class="input-slider">

            </div>
            <span class="user-input money">$<span class="price">0</span></span>
        </div>
        <div id="spend">
            <div class="total">
                <img class="kim kim1" src="img/GAUGES-03.png" alt="" />
                <div class="text align-center">
                    <p><strong>5 YEARS</strong> <i>Current Spending</i></p>
                    <span class="total-spend money">$<span class="price">0</span></span>
                </div>
            </div>
            <div class="first-year">
                <div class="gauge">
                    <img class="kim kim2" src="img/GAUGES-04.png" alt="" />
                </div>
                <div class="text align-center">
                    <p><strong>1 YEAR</strong> <i>Current Spending</i></p>
                    <span class="first-year-spend money">$<span class="price">0</span></span>
                </div>
            </div>
        </div>
        <div id="save">
            <div class="total-save digits">
            </div>
            <p class="total-save"><strong>5 YEARS</strong> <i>Zing Solar Saving</i></p>
            <div class="first-year-save digits">
            </div>
            <p class="first-year-save"><strong>1 YEAR</strong> <i>Zing Solar Saving</i></p>
        </div>
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" ></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
    <script src="js/sevenSeg.js"></script>

    <script>
        $(document).ready(function(){
            var savingRange = [
                {
                    min: 0,
                    max: 74,
                    percentage: 0
                },
                {
                    min: 75,
                    max: 99,
                    percentage: 4
                },
                {
                    min: 100,
                    max: 149,
                    percentage: 16
                },
                {
                    min: 150,
                    max: 199,
                    percentage: 27
                },
                {
                    min: 200,
                    max: 249,
                    percentage: 33
                },
                {
                    min: 250,
                    max: 299,
                    percentage: 37
                },
                {
                    min: 300,
                    max: 349,
                    percentage: 40
                },
                {
                    min: 350,
                    max: 399,
                    percentage: 43
                },
                {
                    min: 400,
                    max: 449,
                    percentage: 45
                },
                {
                    min: 450,
                    max: 699,
                    percentage: 48
                },
                {
                    min: 700,
                    max: 899,
                    percentage: 51
                },
                {
                    min: 900,
                    max: 1199,
                    percentage: 53
                },
                {
                    min: 1200,
                    max: 2499,
                    percentage: 55
                },
                {
                    min: 2500,
                    max: 5000,
                    percentage: 56
                },
            ];
            var increasePercent = [6.7, 13.4, 20.1, 26.8, 33.5];

            // bind digits
            $('.digits').sevenSegArray({
                digits: 5,
                value: 0,
                colorOn: '#e91e24',
                colorOff: '#efeeec',
                colorBackground: '#FFFFFF'
            });

            // start calculating when slider change value
            $('.input-slider').slider({
                max: 2400,
                range: 10,
                start: function(event, ui) {
                    resetNeedle();
                },
                stop: function(event, ui) {

                    /**
                    Based on requirement we just need our gauges always on 60-70%
                    If user input = 0, reset gauges to -90deg
                    */
                    if (ui.value != 0) {
                        var randomGauge1 = getRandomArbitrary(18, 36);
                        var randomGauge2 = getRandomArbitrary(18, 36);

                        // make the needle rotate with stops/jump-point 25% 50%, etc...

                        // reset the needle
                        $.when(resetNeedle()).then(function(){

                            // start to rotate
                            $('img.kim1').rotate(randomGauge1);
                            $('img.kim2').rotate(randomGauge2);

                        });
                    } else {
                        console.log('slider value become 0');
                        resetNeedle();
                    }
                },
                slide: function(event, ui) {
                    var result = getSpendingAndSaving(ui.value);

                    // ui-slider-range
                    $('.ui-slider-range').css('width', ui.value*100/2400 + '%');

                    // saving by digits
                    $(".digits.total-save").sevenSegArray({
                        value: result.saveTotal
                    });
                    $(".digits.first-year-save").sevenSegArray({
                        value: result.saveYear1
                    });

                    // spending
                    $('span.total-spend span.price').html(result.spendTotal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                    $('span.first-year-spend span.price').html(result.spendYear1.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));

                    // user input
                    $('span.user-input span.price').html(ui.value);
                }
            });

            // function reset needle
            function resetNeedle() {
                $('img.kim1').rotate(-90);
                $('img.kim2').rotate(-90);
            }
            
            // create jquery function css transform rotate
            $.fn.rotate = function(deg) {
                // normal
                this.css('transform', 'rotate(' + deg + 'deg)');
                // webkit
                this.css('-webkit-transform', 'rotate(' + deg + 'deg)');
                // moz
                this.css('-moz-transform', 'rotate(' + deg + 'deg)');
                // ms
                this.css('-ms-transform', 'rotate(' + deg + 'deg)');
            }

            // function get random in range min max
            function getRandomArbitrary(min, max) {
                return Math.random() * (max - min) + min;
            }

            // function get spending and saving in 1st year and total 5 years
            function getSpendingAndSaving($inputValue){
                // get saving range
                var savingPercentage = 0;  // saving percentage
                var spendingAndSaving = {
                    spendYear1: 0,  // spending in 1st year
                    spendTotal: 0,  // spending in 5 years
                    saveYear1: 0,  // saving in 1st year
                    saveTotal: 0  // saving in 5 years
                }

                // loop saving range to find percentage based on uer input
                $.each(savingRange, function(){
                    if(this.min <= $inputValue && $inputValue <= this.max) {
                        savingPercentage = this.percentage;
                    }
                });

                // get spend in 1st year
                spendingAndSaving.spendYear1 = $inputValue*12*(100 + increasePercent[0])/100;
                // round result
                spendingAndSaving.spendYear1 = Math.round(spendingAndSaving.spendYear1);

                // get total spend in 5 years
                $.each(increasePercent, function(){
                    spendingAndSaving.spendTotal += $inputValue*12*(100 + this)/100;
                });
                // round spend total
                spendingAndSaving.spendTotal = Math.round(spendingAndSaving.spendTotal);

                // get saving in 1st year
                spendingAndSaving.saveYear1 = spendingAndSaving.spendYear1*savingPercentage/100;
                spendingAndSaving.saveYear1 = Math.round(spendingAndSaving.saveYear1);
                //get saving in 5 years
                spendingAndSaving.saveTotal = spendingAndSaving.spendTotal*savingPercentage/100;
                spendingAndSaving.saveTotal = Math.round(spendingAndSaving.saveTotal);

                // return object
                return spendingAndSaving;
            }
        });
    </script>
</body>
</html>